当浏览器的网络线程收到HTML文档后，会产生一个渲染任务，并将其传递给渲染主线程的消息队列。

在事件循环机制的作用下，渲染主线程取出消息队列中的渲染任务，开启渲染流程。

整个渲染过程分为多个阶段，分别是：HTML解析、样式计算、布局、分层、绘制、分块、光栅化， 每个阶段都有明确的输入输出，上个阶段的输出会成为下一个阶段的输入；这样，整个渲染过程形成了一套组织严密的生产流水线。

**1、渲染的第一步是解析HTML**

解析过程中遇到CSS解析CSS，遇到js执行js；为了提高解析效率，浏览器在开始解析前，会启动一个预解析的线程，率先下载HTML中的外部CSS和外部js；

2、在第一步完成后，会得到DOM树和CSSOM树，浏览器的默认样式、内部样式、外部样式、行内样式都会包含在CSSOM树中。

**渲染的下一步是样式计算**

主线程会遍历得到的dom树，依次为dom树的每个节点计算出最终的样式，称之为Computed Style；

这一步完成后，会得到一颗带有样式的dom树。

**接下来是布局，布局完成后会得到布局树**

布局阶段会依次遍历dom树的每个节点，计算每个节点的几何信息，例如节点的宽高、相对包含块的位置。


**下一步是分层**

主线程会用一套复杂的策略对整个布局树中进行分层。

**再下一步是绘制**

主线程为每一层单独产生绘制指令集，用于描述这一层的内容如何画出来。

将每个图层进行分块，划分为更小的区域，分块的工作是多个线程同时进行的。

**再下一步是光栅化**

光栅化是将每个块变成位图，光栅化会用到GPU加速。



